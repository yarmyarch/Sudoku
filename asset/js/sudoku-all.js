var Sudoku=Sudoku||{};Sudoku.Util=(function(){var a;var b={elemList:{}};return a={g:function(d,c){if(c){return b.elemList[d]=document.getElementById(d)}return b.elemList[d]?b.elemList[d]:(b.elemList[d]=document.getElementById(d))}}})();var Sudoku=Sudoku||{};Sudoku.LocalConfig=(function(){var b=Sudoku.Util;var a={ID:{TITLE:"title",EXPAND_BTN:"expandBtn",ACTION_RESET:"actionReset",ACTION_RESTART:"actionRestart",ACTION_RETREAT:"actionRetreat",ACTION_SHOWTIP:"actionShowTip",TIME_TIP:"timeTip",TIME_PLAYED:"timePlayed",SUDOKU_WRAP:"sudokuWrap",ACTION_WRAP:"actionWrap",HTML_TEMP:"htmlTemplate",PRE_PIXEL:"pixel_",PRE_PIXEL_BUTTON:"pixelItem_"},CLASS_NAME:{V_ALIGN:["align_top","v_center","align_bottom"],H_ALIGN:["align_left","h_center","align_right"]},HTML:{PIXEL:"htmlPixels",PANEL:"htmlPanel"},MAX_HISTORY:4,JUMP_RANGE:120,JUMP_TICK:600,TIP_TICK:10,AUTHOR:"http://www.github.com/yarmyarch",TEXT:{FAIL:"Ahh, okay. Thanks for playing, what about checking something else that's more funny?",SUCCESS:"Wow! You must be kidding... Congratulations! Wanna try it again?"}};var c=function(){var d=b.g(a.ID.HTML_TEMP);for(var e in a.HTML){a.HTML[e]=b.g(a.HTML[e]).value}d.parentNode.removeChild(d)};c();return a})();var Sudoku=Sudoku||{};Sudoku.Board=(function(){var b;var d={MAP_EN:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),MAP_DE:{},MATRIX:"BQMEBgcICQECBgcCAQkFAwQIAQkIAwQCBQYHCAUJBwYBBAIDBAIGCAUDBwkBBwEDCQIECAUGCQYBBQMHAggEAggHBAEJBgMFAwQFAggGAQcJAA==",BLANK_RATE:0.18};for(var c=0;c<64;c++){d.MAP_DE[d.MAP_EN[c]]=c}var a={base64Decode:function(k){var f=[],e=k.split(""),h=d.MAP_DE,l=e.length,j,g=0;if(l%4){return false}while(g<l){j=(h[e[g]]<<18)|(h[e[g+1]]<<12)|(h[e[g+2]]<<6)|(h[e[g+3]]);f.push(j>>16,j>>8&255,j&255);g+=4}while(e[--l]=="="){f.pop()}return f}};return b={generateNew:function(){var g=[1,2,3,4,5,6,7,8,9],f=0,e=g.length,h=a.base64Decode(d.MATRIX);for(var j in g){f=~~(Math.random()*e);if(j!=f){g[j]=g[f]^g[j];g[f]=g[f]^g[j];g[j]=g[f]^g[j]}}for(var j in h){h[j]&&(h[j]=g[h[j]-1])}return h},getRiddle:function(e){var h=e.concat(),g=d.BLANK_RATE;for(var f in h){h[f]=(Math.random()<g)&&h[f]||0}return h},getNext:function(e,j){var h=[],f=0;for(var g in j){if(j[g]!=e[g]){h.push(g)}}f=~~(Math.random()*h.length);return{index:h[f],value:e[h[f]]}},isConflict:function(j,l,h){var g=~~(j/9)*9,f=j%9,e,m;for(var k=0;k<9;++k){e=k+g;m=(k*9+f)%81;if(j!=e&&+l==+h[e]){return true}if(j!=m&&+l==+h[m]){return true}}return false}}})();var Sudoku=Sudoku||{};Sudoku.page=(function(){var b,d=Sudoku;var c={tipTimer:0,matrix:null,riddle:null,status:null,activedIndex:1,historyStack:[],tipTick:10,tipCount:0,tipTimer:0,actionOpened:false,pixelElems:{}};var a={initBoard:function(){var f=0,o=document.createDocumentFragment(),m=document.createElement("div"),k=[],l,p=d.LocalConfig,h=c;for(var n=0;n<9;++n){l=[];for(var g=0;g<9;++g){l.push(p.HTML.PIXEL.replace(/%id%/,n*9+g).replace(/%pos%/,p.CLASS_NAME.V_ALIGN[~~(g/3)]+" "+p.CLASS_NAME.H_ALIGN[g%3]))}k.push(p.HTML.PANEL.replace(/%pixel%/,l.join("")).replace(/%pos%/,p.CLASS_NAME.V_ALIGN[~~(n/3)]+" "+p.CLASS_NAME.H_ALIGN[n%3]))}m.innerHTML=k.join("");o.appendChild(m);d.Util.g(p.ID.SUDOKU_WRAP).appendChild(o);for(var n=0;n<81;++n){h.pixelElems[n]=d.Util.g(p.ID.PRE_PIXEL+n)}},fillBoard:function(m){var l=0,k=d.Util,f=d.LocalConfig,h=c,j;for(var g in m){if(l=m[g]){j=h.pixelElems[g];j.parentNode.className=j.parentNode.className.replace(/\s+(blank)|(init)/g,"")+" init";j.innerHTML=m[g]}}h.status=m.concat()},fadeIn:function(){var m=0,l=0,g=c.pixelElems,f=d.LocalConfig,h=0,k;for(var j in g){m=~~((Math.random()-0.5)*f.JUMP_RANGE);l=~~((Math.random()-0.5)*f.JUMP_RANGE);h=~~(Math.random()*f.JUMP_TICK);k=g[j].parentNode;k.className=k.className.replace(/\s+hidden/,"")+" fadeout";k.style.left=m+"px";k.style.top=l+"px";setTimeout((function(n){return function(){k=g[n].parentNode;k.className=k.className.replace(/\s+fadeout/,"");k.style.left="0px";k.style.top="0px"}})(j),h)}},fadeOut:function(){var m=0,l=0,g=c.pixelElems,f=d.LocalConfig,h=0,k;for(var j in g){m=~~((Math.random()-0.5)*f.JUMP_RANGE);l=~~((Math.random()-0.5)*f.JUMP_RANGE);h=~~(Math.random()*f.JUMP_TICK);k=g[j].parentNode;k.className=k.className+" fadeout";k.style.left=m+"px";k.style.top=l+"px";setTimeout((function(n){return function(){g[n].parentNode.className=g[n].parentNode.className.replace(/\s+fadeout/,"")+" hidden"}})(j),h)}},clear:function(){var f=c.pixelElems;for(var g in f){f[g].parentNode.className=f[g].parentNode.className.replace(/\s+(blank)|(init)/,"")+" blank";f[g].innerHTML=""}},start:function(){var f=a,h=c,g=d.Board,i=0;h.matrix=g.generateNew();h.riddle=g.getRiddle(h.matrix);f.fillBoard(h.riddle);f.fadeIn()},startTipTick:function(){var i=c,j=d.Util,f=d.LocalConfig,h=j.g(f.ID.ACTION_SHOWTIP),g=j.g(f.ID.TIME_TIP);clearInterval(i.tipTimer);++i.tipCount;i.tipTick=i.tipCount*f.TIP_TICK;g.innerHTML="("+i.tipTick+")";h.className=h.className.replace(/\s+disabled/g,"")+" disabled";i.tipTimer=setInterval(function(){i.tipTick--;if(i.tipTick>0){h.className=h.className.replace(/\s+disabled/g,"")+" disabled";g.innerHTML="("+i.tipTick+")"}else{h.className=h.className.replace(/\s+disabled/g,"");g.innerHTML="";clearInterval(i.tipTimer)}},1000)},restartTipTick:function(){var f=c;clearInterval(f.tipTimer);f.tipCount=0;a.startTipTick()},initEvents:function(){var j=d.Util,f=d.LocalConfig,h=c;for(var g=1;g<=9;++g){j.g(f.ID.PRE_PIXEL_BUTTON+g).onclick=(function(k){return function(){var i=j.g(f.ID.PRE_PIXEL_BUTTON+h.activedIndex);i.className=i.className.replace(/\s+active/,"");h.activedIndex=k;i=j.g(f.ID.PRE_PIXEL_BUTTON+h.activedIndex);i.className=i.className.replace(/\s+active/,"")+" active"}})(g)}for(var g=0;g<81;++g){j.g(f.ID.PRE_PIXEL+g).onmouseover=(function(k){return function(){if(h.riddle[k]||h.status[k]==h.activedIndex){return}if(h.activedIndex){var i=j.g(f.ID.PRE_PIXEL+k);i.parentNode.className=i.parentNode.className.replace(/\s+(preview)|(blank)|(conflict)/g,"")+" preview";i.innerHTML=h.activedIndex}if(d.Board.isConflict(k,h.activedIndex,h.status)){i.parentNode.className=i.parentNode.className.replace(/\s+conflict/g,"")+" conflict"}}})(g);j.g(f.ID.PRE_PIXEL+g).onmouseout=(function(k){return function(){if(h.riddle[k]||h.status[k]==h.activedIndex){return}var i=j.g(f.ID.PRE_PIXEL+k);i.parentNode.className=i.parentNode.className.replace(/\s+(preview)|(conflict)/g,"")+(!(h.status[k])?" blank":"");i.innerHTML=h.status[k]||"";if(h.status[k]&&d.Board.isConflict(k,h.status[k],h.status)){i.parentNode.className=i.parentNode.className.replace(/\s+conflict/g,"")+" conflict"}}})(g);j.g(f.ID.PRE_PIXEL+g).onclick=(function(k){return function(){if(h.riddle[k]||h.status[k]==h.activedIndex){return}if(h.activedIndex){var l=j.g(f.ID.PRE_PIXEL+k),m;l.parentNode.className=l.parentNode.className.replace(/\s+(preview)|(blank)|(conflict)/g,"");l.innerHTML=h.activedIndex;var n=f.MAX_HISTORY;h.historyStack.push(k);for(var i=h.historyStack.length-1;i>=0;--i,--n){m=j.g(f.ID.PRE_PIXEL+h.historyStack[i]);m.parentNode.className=m.parentNode.className.replace(/\s+pixel-level-\d+/g,"")+" pixel-level-"+n}if(h.historyStack.length>f.MAX_HISTORY){h.historyStack.shift()}if(d.Board.isConflict(k,h.activedIndex,h.status)){l.parentNode.className=l.parentNode.className.replace(/\s+(conflict)/g,"")+" conflict"}else{a.checkWin()}h.status[k]=h.activedIndex}}})(g)}j.g(f.ID.ACTION_RESTART).onclick=function(){b.restart()};j.g(f.ID.ACTION_RESET).onclick=function(){b.reset()};j.g(f.ID.ACTION_RETREAT).onclick=function(){b.retreat()};j.g(f.ID.ACTION_SHOWTIP).onclick=function(){b.showTip()};j.g(f.ID.EXPAND_BTN).onclick=function(i){var i=i||window.event;i.stopPropagation&&i.stopPropagation()||(i.cancelBubble=true);b.showActions()};window.onclick=function(){b.hideActions()}},checkWin:function(){var j=true,h=c,f=d.LocalConfig;for(var g=0;g<81;++g){if(!h.status[g]){j=false;break}}if(j&&confirm(f.TEXT.SUCCESS)){b.restart()}}};var e=function(){var f=a,h=c,g=d.Board;f.initBoard();f.start();f.startTipTick();f.initEvents();return true};b={reset:function(){var f=a;f.fadeOut();setTimeout(function(){f.clear();f.fillBoard(c.riddle);f.fadeIn();f.restartTipTick()},d.LocalConfig.JUMP_TICK)},restart:function(){var f=a;f.fadeOut();setTimeout(function(){f.clear();f.start();f.restartTipTick()},d.LocalConfig.JUMP_TICK)},retreat:function(){if(confirm(d.LocalConfig.TEXT.FAIL)){window.location=d.LocalConfig.AUTHOR}},showTip:function(){if(c.tipTick>0){return}var g=c,j=d.Board.getNext(g.matrix,g.riddle),i=d.Util,f=d.LocalConfig,h=i.g(f.ID.PRE_PIXEL+j.index);g.riddle[j.index]=g.status[j.index]=j.value;h.parentNode.className=h.parentNode.className.replace(/\s+(preview)|(blank)|(conflict)/g,"");h.innerHTML=j.value;a.checkWin();a.startTipTick()},showActions:function(){var g=d.Util.g(d.LocalConfig.ID.ACTION_WRAP),f=g.scrollHeight;g.style.height=f+"px";c.actionOpened=true},hideActions:function(){if(c.actionOpened){d.Util.g(d.LocalConfig.ID.ACTION_WRAP).style.height="0px";c.actionOpened=false}}};if(e()){return b}})();